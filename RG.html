<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rust Item Guesser</title>
    <style>
        /* Rust-inspired CSS */
        body {
            font-family: 'Arial', sans-serif; /* A more common, 'harder' font */
            background-color: #1a1a1a; /* Very dark background */
            color: #d0d0d0; /* Light grey text */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        .game-container {
            background-color: #252525; /* Darker panel */
            border-radius: 8px; /* Slightly sharper corners */
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.6); /* More prominent shadow */
            border: 1px solid #404040; /* Subtle border for definition */
            padding: 30px;
            text-align: center;
            width: 100%;
            max-width: 700px;
        }

        h1 {
            color: #c84820; /* Gritty, desaturated red/orange */
            margin-bottom: 25px;
            font-size: 2.8em;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.4);
            letter-spacing: 1px;
            text-transform: uppercase; /* More industrial feel */
        }

        h2 {
            color: #b0b0b0; /* Muted heading color */
            margin-bottom: 20px;
            font-size: 1.9em;
            text-transform: uppercase;
        }

        p {
            color: #a0a0a0; /* Standard paragraph text */
        }

        .screen {
            margin-top: 20px;
        }

        .hidden {
            display: none;
        }

        button {
            background-color: #a03010; /* Stronger, darker red for primary actions */
            color: white;
            border: 1px solid #702008; /* Darker border */
            padding: 14px 28px; /* Larger hit area */
            margin: 10px;
            border-radius: 5px; /* Slightly sharper button edges */
            cursor: pointer;
            font-size: 1.2em;
            font-weight: bold;
            transition: background-color 0.2s ease, transform 0.1s ease, border-color 0.2s ease;
            min-width: 180px; /* Ensure buttons have a minimum width */
            text-transform: uppercase;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3); /* Subtle shadow for depth */
        }

        button:hover {
            background-color: #c04020; /* Brighter red on hover */
            transform: translateY(-2px);
            border-color: #903010;
        }

        button:active {
            background-color: #802505; /* Even darker on click */
            transform: translateY(0);
            box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.4) inset; /* Inset shadow for press effect */
        }

        button:disabled {
            background-color: #444;
            border-color: #333;
            color: #888;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        #choices-container {
            display: grid;
            grid-template-columns: 1fr; /* Default to single column */
            gap: 12px; /* Slightly tighter gap */
            margin-top: 30px;
        }

        /* Adjust for wider screens to make 2 columns */
        @media (min-width: 600px) {
            #choices-container {
                grid-template-columns: 1fr 1fr;
            }
        }

        .choice-button {
            background-color: #383838; /* Darker grey for choice panels */
            color: #d0d0d0;
            border: 1px solid #505050; /* Defined border */
            padding: 18px; /* More padding for text */
            border-radius: 5px; /* Sharper corners */
            cursor: pointer;
            font-size: 1.05em;
            text-align: left;
            transition: background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
            line-height: 1.5;
            min-height: 90px; /* Ensure choices have some height */
            display: flex;
            align-items: center;
            box-shadow: 1px 1px 4px rgba(0, 0, 0, 0.2); /* Subtle depth */
        }

        .choice-button:hover:not(:disabled) {
            background-color: #4a4a4a; /* Slightly lighter on hover */
            border-color: #c84820; /* Rust red highlight on hover */
            box-shadow: 0 0 8px rgba(200, 72, 32, 0.4); /* Glowing effect */
        }

        .choice-button.correct {
            background-color: #3a6a3a; /* Desaturated, deep green */
            border-color: #2a4a2a;
            box-shadow: 0 0 12px rgba(58, 106, 58, 0.6);
        }

        .choice-button.incorrect {
            background-color: #8a3a3a; /* Desaturated, deep red */
            border-color: #6a2a2a;
            box-shadow: 0 0 12px rgba(138, 58, 58, 0.6);
        }

        #progress-text, #score-text {
            font-size: 1.3em;
            margin-bottom: 10px;
            color: #c0c0c0;
            font-weight: bold;
        }

        #feedback-text {
            margin-top: 25px;
            font-weight: bold;
            font-size: 1.6em;
            color: #c84820; /* Rust red for feedback */
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            text-transform: uppercase;
        }

        #final-score-text {
            font-size: 1.8em;
            margin-bottom: 30px;
            color: #e0e0e0;
            font-weight: bold;
        }

        /* Message for loading errors */
        #loading-error-message {
            background-color: #383838;
            color: #c84820;
            border: 1px solid #a03010;
            padding: 20px;
            margin-top: 20px;
            border-radius: 8px;
            font-size: 1.1em;
            line-height: 1.5;
            text-align: left;
            display: none; /* Hidden by default */
        }
        #loading-error-message code {
            background-color: #1a1a1a;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: monospace;
            color: #ffe0b2;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>Rust Item Guesser</h1>

        <!-- Menu Screen -->
        <div id="menu-screen" class="screen">
            <h2>Choose Difficulty</h2>
            <button id="easy-btn" data-difficulty="easy">Easy (10 Items)</button>
            <button id="medium-btn" data-difficulty="medium">Medium (25 Items)</button>
            <button id="expert-btn" data-difficulty="expert">Expert (All Items)</button>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="screen hidden">
            <p id="progress-text">0/0</p>
            <p id="score-text">Score: 0</p>
            <h2 id="question-text">What description belongs to: Item Name?</h2>
            <div id="choices-container">
                <!-- Choices will be injected here by JavaScript -->
            </div>
            <p id="feedback-text" class="hidden"></p>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="screen hidden">
            <h2>Game Over!</h2>
            <p id="final-score-text"></p>
            <button id="restart-btn">Play Again</button>
        </div>

        <!-- Loading Error Message (initially hidden) -->
        <div id="loading-error-message" class="hidden">
            <h3>âš  Error Loading Game Data</h3>
            <p>Could not load <code>items.json</code>. This usually happens when opening the HTML file directly from your computer (<code>file://</code> protocol).</p>
            <p><strong>To fix this:</strong></p>
            <ol>
                <li><strong>Run a Local Web Server:</strong></li>
                <li>Navigate to this folder in your terminal/command prompt.</li>
                <li>Run <code>python -m http.server</code> (if you have Python 3) or <code>npx serve</code> (if you have Node.js and serve installed).</li>
                <li>Open your browser to the address provided (e.g., <code>http://localhost:8000</code>).</li>
            </ol>
            <p>Ensure <code>items.json</code> is in the same directory as this HTML file and is correctly formatted JSON.</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const menuScreen = document.getElementById('menu-screen');
            const gameScreen = document.getElementById('game-screen');
            const resultsScreen = document.getElementById('results-screen');
            const loadingErrorMessage = document.getElementById('loading-error-message');

            const easyBtn = document.getElementById('easy-btn');
            const mediumBtn = document.getElementById('medium-btn');
            const expertBtn = document.getElementById('expert-btn');
            const restartBtn = document.getElementById('restart-btn');

            const progressText = document.getElementById('progress-text');
            const scoreText = document.getElementById('score-text');
            const questionText = document.getElementById('question-text');
            const choicesContainer = document.getElementById('choices-container');
            const feedbackText = document.getElementById('feedback-text');
            const finalScoreText = document.getElementById('final-score-text');

            // Game Variables
            let allItems = []; // Stores all valid items from items.json
            let gameItems = []; // Items for the current game session
            let currentItemIndex = 0;
            let score = 0;
            let totalQuestions = 0;
            let currentDifficulty = '';

            // --- Utility Functions ---

            // Shuffles an array (Fisher-Yates algorithm)
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            // Displays a specific screen and hides others
            function showScreen(screenToShow) {
                menuScreen.classList.add('hidden');
                gameScreen.classList.add('hidden');
                resultsScreen.classList.add('hidden');
                loadingErrorMessage.classList.add('hidden'); // Always hide error message when showing game screens
                screenToShow.classList.remove('hidden');
            }

            // --- Game Logic ---

            // Loads item data from items.json and filters them
            async function loadItemsData() {
                // Hide all game screens and show a loading indicator or just prepare
                showScreen(menuScreen); // Default to menu screen
                loadingErrorMessage.classList.add('hidden'); // Hide any previous error

                try {
                    const response = await fetch('items.json');
                    if (!response.ok) {
                        // Check for common errors like file not found (404)
                        if (response.status === 404) {
                            throw new Error('items.json not found.');
                        }
                        // Generic error for other HTTP issues (e.g., CORS)
                        throw new Error(`HTTP error! Status: ${response.status}.`);
                    }
                    const rawItems = await response.json();

                    // Filter out items where displayName or description is null/empty/whitespace only
                    allItems = rawItems.filter(item =>
                        item.displayName && String(item.displayName).trim() !== '' &&
                        item.description && String(item.description).trim() !== ''
                    );

                    // Basic validation: ensure allItems is an array and has items
                    if (!Array.isArray(allItems) || allItems.length === 0) {
                        throw new Error('No valid items found in items.json after filtering (missing or empty displayName/description).');
                    }
                    console.log('Valid items loaded:', allItems.length);
                    // Buttons should be enabled by default, but this can ensure if they were disabled before an error
                    enableDifficultyButtons(true);
                    showMenu(); // Show menu only after items are successfully loaded
                } catch (error) {
                    console.error('Could not load or parse items.json:', error);
                    showScreen(loadingErrorMessage); // Show the error message
                    // Disable game start buttons
                    enableDifficultyButtons(false);
                }
            }

            function enableDifficultyButtons(enabled) {
                easyBtn.disabled = !enabled;
                mediumBtn.disabled = !enabled;
                expertBtn.disabled = !enabled;
            }

            // Shows the main menu
            function showMenu() {
                showScreen(menuScreen);
                feedbackText.classList.add('hidden'); // Hide any previous feedback
                feedbackText.textContent = '';
            }

            // Starts the game based on chosen difficulty
            function startGame(difficulty) {
                currentDifficulty = difficulty;
                currentItemIndex = 0;
                score = 0;
                feedbackText.classList.add('hidden'); // Hide feedback from previous game

                // Determine game items based on difficulty
                if (difficulty === 'expert') {
                    gameItems = shuffleArray([...allItems]); // Use all items, shuffled
                } else {
                    const numItems = difficulty === 'easy' ? 10 : 25;
                    // Ensure we don't try to get more items than available
                    const itemsToPick = Math.min(numItems, allItems.length);
                    // Shuffle allItems and take the required number
                    gameItems = shuffleArray([...allItems]).slice(0, itemsToPick);
                }

                totalQuestions = gameItems.length;
                console.log(`Starting ${difficulty} game with ${totalQuestions} items.`);

                // If no items are selected (e.g., filtered data is too small for difficulty), go back to menu
                if (totalQuestions === 0) {
                    alert('Not enough valid items available for this difficulty after filtering. Please check your items.json file or choose an easier difficulty.');
                    showMenu();
                    return;
                }

                showScreen(gameScreen);
                displayNextQuestion();
            }

            // Displays the current question
            function displayNextQuestion() {
                if (currentItemIndex >= totalQuestions) {
                    endGame();
                    return;
                }

                const currentItem = gameItems[currentItemIndex];
                // Use displayName for the question text
                questionText.textContent = `What description belongs to: ${currentItem.displayName}?`;
                scoreText.textContent = `Score: ${score}`;
                progressText.textContent = `Question: ${currentItemIndex + 1}/${totalQuestions}`;

                // Clear previous choices and feedback
                choicesContainer.innerHTML = '';
                feedbackText.classList.add('hidden');
                feedbackText.textContent = '';

                // Generate choices
                const correctDescription = currentItem.description;
                const incorrectDescriptions = new Set(); // Use a Set to ensure uniqueness

                // Filter out the current item and get other valid descriptions
                const otherItems = allItems.filter(item =>
                    item.displayName !== currentItem.displayName &&
                    item.description && String(item.description).trim() !== ''
                );

                // Populate incorrect descriptions (up to 3 unique ones)
                const shuffledOtherItems = shuffleArray(otherItems);
                for (let i = 0; incorrectDescriptions.size < 3 && i < shuffledOtherItems.length; i++) {
                    incorrectDescriptions.add(shuffledOtherItems[i].description);
                }

                // Combine correct and unique incorrect descriptions
                const allChoices = [
                    { text: correctDescription, isCorrect: true },
                    ...Array.from(incorrectDescriptions).map(info => ({ text: info, isCorrect: false }))
                ];

                // Ensure there are always 4 choices if possible. If not enough unique incorrect ones,
                // the game will proceed with fewer choices. This makes it more robust for small datasets.
                while (allChoices.length < 4 && allChoices.length < allItems.length) {
                    // Find a random valid item not already represented in choices
                    const randomItem = allItems[Math.floor(Math.random() * allItems.length)];
                    if (randomItem.description && String(randomItem.description).trim() !== '' && !allChoices.some(choice => choice.text === randomItem.description)) {
                        allChoices.push({ text: randomItem.description, isCorrect: false });
                    }
                }

                // Shuffle choices before displaying
                shuffleArray(allChoices);

                // Create and append choice buttons
                allChoices.forEach(choice => {
                    const button = document.createElement('button');
                    button.classList.add('choice-button');
                    button.textContent = choice.text;
                    if (choice.isCorrect) {
                        button.dataset.correct = 'true';
                    }
                    button.addEventListener('click', () => handleChoiceClick(button));
                    choicesContainer.appendChild(button);
                });
            }

            // Handles a choice button click
            function handleChoiceClick(selectedButton) {
                const isCorrect = selectedButton.dataset.correct === 'true';
                const allChoiceButtons = choicesContainer.querySelectorAll('.choice-button');

                // Disable all buttons to prevent multiple clicks
                allChoiceButtons.forEach(btn => btn.disabled = true);

                if (isCorrect) {
                    score++;
                    selectedButton.classList.add('correct');
                    feedbackText.textContent = 'Correct!';
                    feedbackText.style.color = '#3a6a3a'; // Desaturated green for correct feedback
                } else {
                    selectedButton.classList.add('incorrect');
                    feedbackText.textContent = 'Incorrect!';
                    feedbackText.style.color = '#8a3a3a'; // Desaturated red for incorrect feedback
                    // Highlight the correct answer
                    const correctAnswerButton = choicesContainer.querySelector('[data-correct="true"]');
                    if (correctAnswerButton) {
                        correctAnswerButton.classList.add('correct');
                    }
                }
                feedbackText.classList.remove('hidden');

                currentItemIndex++;

                // Wait a bit, then display next question or end game
                setTimeout(() => {
                    displayNextQuestion();
                }, 1500); // 1.5 second delay
            }

            // Ends the game and shows results
            function endGame() {
                showScreen(resultsScreen);
                finalScoreText.textContent = `You scored ${score} out of ${totalQuestions} items!`;
            }

            // --- Event Listeners ---

            easyBtn.addEventListener('click', () => startGame('easy'));
            mediumBtn.addEventListener('click', () => startGame('medium'));
            expertBtn.addEventListener('click', () => startGame('expert'));
            restartBtn.addEventListener('click', showMenu);

            // Initial game setup: load items data
            loadItemsData();
        });
    </script>
</body>
</html>